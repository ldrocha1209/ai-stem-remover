document.getElementById("stemForm").addEventListener("submit",async function(e){e.preventDefault();let t=document.getElementById("stemForm"),u=document.getElementById("uploadSection"),l=document.getElementById("file"),n=document.getElementById("stem"),s=document.getElementById("downloadHref"),d=document.getElementById("loader"),i=document.getElementById("statusMessage"),o=document.getElementById("audioPreview"),r=document.getElementById("tryAnother"),h=document.getElementById("formTitle"),a=document.getElementById("downloadButtonContainer"),c=document.getElementById("resultsCard");if(!l.files.length){alert("Please select an audio file.");return}t.classList.add("hidden"),u.classList.add("hidden"),d.classList.remove("hidden"),i.classList.add("hidden"),h.classList.add("hidden");let m=new FormData;m.append("file",l.files[0]),m.append("stem",n.value);let f=setTimeout(()=>{i.innerText="⏳ Still processing... hang tight.",i.classList.remove("hidden")},15e3);try{let y=await fetch("/isolate",{method:"POST",body:m});if(clearTimeout(f),d.classList.add("hidden"),!y.ok)throw Error("Server returned an error");let E=await y.blob(),v=window.URL.createObjectURL(E),g=l.files[0].name.replace(/\.[^/.]+$/,""),p=`${g} (${n.value} isolated).wav`;s.href=v,s.download=p,o.src=v,c.classList.remove("hidden"),a.classList.remove("hidden");let M=document.querySelector(".ready-message");M.classList.remove("ready-message"),void M.offsetWidth,M.classList.add("ready-message"),r.addEventListener("click",()=>window.location.reload())}catch(x){clearTimeout(f),d.classList.add("hidden"),alert("❌ Failed to process audio: "+x.message)}});
